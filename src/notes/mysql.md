# mysql逻辑结构

# mysql索引
## 是什么？
+ MySQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。
可以得到索引的本质：索引是数据结构。

+ 你可以简单理解为“排好序的快速查找数据结构”。

数据本身之外，数据库还维护着一个满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，
这样就可以在这些数据结构的基础上实现高级查找算法，这种数据结构就是索引。

+ 一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上
我们平常所说的索引，如果没有特别指明，都是指B树(多路搜索树，并不一定是二叉的)结构组织的索引
## 优势
+ 类拟大学图书馆建书目索引，提高数据检索的效率，降低数据库的IO成本
+ 通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗
## 劣势
+ 实际上索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录，所以索引列也是要占用空间的
+ 虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。
  因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，
  都会调整因为更新所带来的键值变化后的索引信息
+ 索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句

## explain

使用EXPLAIN关键字可以模拟优化器执行SQL查询语句，从而知道MySQL是
如何处理你的SQL语句的。分析你的查询语句或是表结构的性能瓶颈

explain + sql

能干嘛
1. 表的读取顺序
2. 数据读取操作的操作类型
3. 哪些索引可以使用
4. 哪些索引被实际使用
5. 表之间的引用
6. 每张表有多少行被优化器查询

> 1. `id` :select查询的序列号,包含一组数字，表示查询中执行select子句或操作表的顺序

分三种情况：
+ id相同，执行顺序由上至下
+ id不同，如果是子查询，id的序号会递增，id值越大优先级越高，越先被执行
+ id相同不同，同时存在。

> 2. `select_type`:查询的类型，主要是用于区别普通查询、联合查询、子查询等的复杂查询
+ `SIMPLE`:简单的 select 查询,查询中不包含子查询或者UNION
+ `PRIMARY`:查询中若包含任何复杂的子部分，最外层查询则被标记为
+ `SUBQUERY`:在SELECT或WHERE列表中包含了子查询
+ `DERIVED`:在FROM列表中包含的子查询被标记为DERIVED(衍生)MySQL会递归执行这些子查询, 把结果放在临时表里。
+ `UNION`:若第二个SELECT出现在UNION之后，则被标记为UNION；若UNION包含在FROM子句的子查询中,外层SELECT将被标记为：DERIVED
+ `UNION RESULT`:从UNION表获取结果的SELECT

> 3. `table`:显示这一行的数据是关于哪张表的

> 4. `type`:显示查询使用了何种类型，
            从最好到最差依次是：`system>const>eq_ref>ref>range>index>ALL`
+ `system`：表只有一行记录（等于系统表），这是const类型的特列，平时不会出现，这个也可以忽略不计
+ `const`：表示通过索引一次就找到了,const用于比较primary key或者unique索引。因为只匹配一行数据，所以很快。
          如将主键置于where列表中，MySQL就能将该查询转换为一个常量
+ `eq_ref`：唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配。常见于主键或唯一索引扫描
+ `ref`：非唯一性索引扫描，返回匹配某个单独值的所有行.
        本质上也是一种索引访问，它返回所有匹配某个单独值的行，然而，
        它可能会找到多个符合条件的行，所以他应该属于查找和扫描的混合体
+ `range`：只检索给定范围的行,使用一个索引来选择行。key 列显示使用了哪个索引
          一般就是在你的where语句中出现了between、<、>、in等的查询
          这种范围扫描索引扫描比全表扫描要好，因为它只需要开始于索引的某一点，而结束语另一点，不用扫描全部索引。
+ `index`：Full Index Scan，index与ALL区别为index类型只遍历索引树。这通常比ALL快，因为索引文件通常比数据文件小。
          （也就是说虽然all和Index都是读全表，但index是从索引中读取的，而all是从硬盘中读的）
+ `all`：Full Table Scan，将遍历全表以找到匹配的行

备注：一般来说，得保证查询至少达到range级别，最好能达到ref。